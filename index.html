<!DOCTYPE html>
<html lang="ml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>കരുളായി ഗ്രാമ പഞ്ചായത്ത് കേരളോത്സവം 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+Malayalam:wght@756&display=swap" rel="stylesheet">
    <!-- PDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <style>
        body { font-family: 'Noto Serif Malayalam', serif; background-color: #f0f4f8; }
        .tab-button.active { border-bottom-color: #3b82f6; color: #3b82f6; background-color: #eff6ff; }
        #announcement-container { width: 100%; overflow: hidden; white-space: nowrap; box-sizing: border-box; }
        #announcement-text { display: inline-block; padding-left: 100%; animation: marquee 20s linear infinite; }
        @keyframes marquee { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }
        
        /* Slideshow Effects */
        #slideshow-container .slide {
            opacity: 0;
            transform: scale(1.1);
            transition: opacity 1.5s ease-in-out, transform 6s ease-in-out;
        }
        #slideshow-container .slide.active {
            opacity: 1;
            transform: scale(1);
        }

        /* New Live Marquee Style */
        #live-events-marquee-container {
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
        }
        #live-events-list-marquee {
            display: inline-block;
            padding-left: 100%;
            animation: marquee-live 30s linear infinite;
        }
        @keyframes marquee-live {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex flex-col min-h-screen">

    <div class="container mx-auto p-4 flex-grow">
        <header class="text-center mb-6 bg-white p-4 rounded-lg shadow-md">
            <h1 class="text-2xl md:text-4xl font-bold text-blue-600">കരുളായി ഗ്രാമ പഞ്ചായത്ത് കേരളോത്സവം 2025</h1>
        </header>

        <!-- Tabs -->
        <div class="mb-4 bg-white rounded-lg shadow-sm">
            <div class="flex flex-wrap border-b">
                <button class="tab-button flex-grow md:flex-1 py-3 px-2 font-semibold text-gray-600 active" onclick="switchView('leaderboard')">ലീഡർബോർഡ്</button>
                <button class="tab-button flex-grow md:flex-1 py-3 px-2 font-semibold text-gray-600" onclick="switchView('dashboard')">ഡാഷ്‌ബോർഡ്</button>
            </div>
        </div>

        <div id="views-container">
            <!-- Leaderboard View -->
            <div id="leaderboard" class="view-content bg-white p-6 rounded-lg shadow text-center">
                <img src="https://karulaipanchayatkeralotsavam.kesug.com/wp-content/uploads/2025/08/keral-logo-ty-1024x378.png" alt="Keralotsavam Logo" class="mx-auto mb-4 h-24">
                
                <!-- Image Slideshow -->
                <div id="slideshow-container" class="relative w-full max-w-2xl mx-auto my-6 rounded-lg overflow-hidden shadow-lg h-56 md:h-80">
                    <img src="images/1.webp" class="slide absolute w-full h-full object-cover" alt="Keralotsavam Image 1" onerror="this.onerror=null;this.src='https://placehold.co/800x400/cccccc/ffffff?text=Image+Not+Found';">
                    <img src="images/2.webp" class="slide absolute w-full h-full object-cover" alt="Keralotsavam Image 2" onerror="this.onerror=null;this.src='https://placehold.co/800x400/cccccc/ffffff?text=Image+Not+Found';">
                    <img src="images/3.webp" class="slide absolute w-full h-full object-cover" alt="Keralotsavam Image 3" onerror="this.onerror=null;this.src='https://placehold.co/800x400/cccccc/ffffff?text=Image+Not+Found';">
                </div>
                
                <!-- LIVE EVENTS DISPLAY -->
                <div id="live-events-display" class="hidden my-6 p-3 bg-gray-900 text-white rounded-lg shadow-lg flex items-center space-x-4 overflow-hidden">
                    <span class="flex-shrink-0 bg-red-600 font-bold px-4 py-1 rounded text-md animate-pulse">LIVE</span>
                    <div id="live-events-marquee-container">
                        <span id="live-events-list-marquee" class="text-lg font-semibold">
                            <!-- Live events will be populated by JS -->
                        </span>
                    </div>
                </div>

                <h2 class="text-xl font-semibold text-center mb-4 text-gray-600 tracking-wider">പോയിന്റ് ടേബിൾ </h2>
                <div id="announcement-container" class="hidden my-6 p-3 bg-red-600 text-white rounded-md font-semibold text-lg">
                    <p id="announcement-text"></p>
                </div>
                <div id="leaderboard-container">Loading...</div>
            </div>
            
            <!-- Dashboard View -->
            <div id="dashboard" class="view-content hidden bg-white p-6 rounded-lg shadow">
                <h2 class="text-2xl font-bold mb-4">ഡാഷ്‌ബോർഡ്</h2>
                <div class="mb-6">
                    <h3 class="text-xl font-semibold mb-3">മത്സരങ്ങളുടെ നില</h3>
                    <div id="overall-status" class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center"></div>
                </div>
                
                <div id="dashboard-event-list" class="mt-6 bg-blue-50 p-4 rounded-lg shadow-inner hidden">
                    <h4 id="event-list-title" class="text-lg font-bold mb-3 text-blue-800"></h4>
                    <div id="event-list-content" class="max-h-60 overflow-y-auto"></div>
                </div>

                 <div class="mt-8">
                    <h3 class="text-xl font-semibold mb-3">ക്ലബ്ബ് റിപ്പോർട്ട്</h3>
                    <select id="dashboardClubSelect" class="block w-full md:w-1/2 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        <option value="">-- ഒരു ക്ലബ്ബ് തിരഞ്ഞെടുക്കുക --</option>
                    </select>
                    <div id="club-report-container" class="mt-4 p-4 border rounded-lg bg-gray-50 min-h-[100px]">
                       <p class="text-gray-500">ഒരു ക്ലബ്ബിന്റെ വിശദമായ റിപ്പോർട്ട് കാണാൻ മുകളിൽ നിന്നും തിരഞ്ഞെടുക്കുക.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="text-center p-4 mt-8 text-gray-600 text-sm">
        <p>website design SAM Digital</p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, collection, onSnapshot, doc } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";
        
        // It's recommended to move this to a separate, non-public file
        const firebaseConfig = {
            apiKey: "AIzaSyCGWjSR9o8-IheGk0V9HFsIYqnKXWpBiy8",
            authDomain: "karulaipanchayatkeralosavam.firebaseapp.com",
            databaseURL: "https://karulaipanchayatkeralosavam-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "karulaipanchayatkeralosavam",
            storageBucket: "karulaipanchayatkeralotsavam.appspot.com",
            messagingSenderId: "906167504851",
            appId: "1:906167504851:web:a075af736e71ab3eede926"
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const clubs = ["VICTORS PANCHAYATHUMPADI", "JUNIORS HIGH SCHOOL KUNNU", "RUBECON CHERUPUZHA", "YUVA STAR MUKKAM", "GSTAR MAILAMBARA", "SPARK PILAKKOTTUPADAM", "NAVA CHAITHANYA THAZHE PILAKOTUPADAM", "VASCO VARIKKAL", "VIVA CHALLENGERS PULLIYIL", "IDEAL VARAKULAM", "SEVAN STAR KARINTHAR", "UNESCO PILAKOTTUPADAM", "UDAYA CHETTIYIL", "MAS MAILAMBARA", "NATTUKKOOTTAM WHATSAPP  KOOTTAAYMA", "NEW BASK NEDUMKAYAM", "AIC AMBALAPADI", "YOUVA MARUTHANGADU", "IDENTITY KARLIKKODE", "SOUHRDHA NILAMPATHY", "NEW WELLDON MILLUMPADI"];
        
        const orderedEventNames = [
             "100 M SENIOR BOYS", "200 M SENIOR BOYS", "400 M SENIOR BOYS", "800 M SENIOR BOYS", "1500 M SENIOR BOYS", "5000 M SENIOR BOYS", "4X100 M RELAY SENIOR BOYS", "SHOT PUT SENIOR BOYS", "DISCUS THROW SENIOR BOYS", "JAVELIN THROW SENIOR BOYS", "HIGH JUMB SENIOR BOYS", "LONG JUMB SENIOR BOYS", "TRIPLE JUMB SENIOR BOYS", "100 M SENIOR GIRLS", "200 M SENIOR GIRLS", "400 M SENIOR GIRLS", "800 M SENIOR GIRLS", "1500 M SENIOR GIRLS", "5000 M SENIOR GIRLS", "4X100 M RELAY SENIOR GIRLS", "SHOT PUT SENIOR GIRLS", "DISCUS THROW SENIOR GIRLS", "JAVELIN THROW SENIOR GIRLS", "HIGH JUMB SENIOR GIRLS", "LONG JUMB SENIOR GIRLS", "TRIPLE JUMB SENIOR GIRLS", "100 M MEN", "200 M MEN", "400 M MEN", "800 M MEN", "1500 M MEN", "5000 M MEN", "4X100 M RELAY MEN", "SHOT PUT MEN", "DISCUS THROW MEN", "JAVELIN THROW MEN", "HIGH JUMB MEN", "LONG JUMB MEN", "TRIPLE JUMB MEN", "100 M WOMEN", "200 M WOMEN", "400 M WOMEN", "800 M WOMEN", "1500 M WOMEN", "5000 M WOMEN", "4X100 M RELAY WOMEN", "SHOT PUT WOMEN", "DISCUS THROW WOMEN", "JAVELIN THROW WOMEN", "HIGH JUMB WOMEN", "LONG JUMB WOMEN", "TRIPLE JUMB WOMEN", "BADMINTON MEN", "BADMINTON (DOUBLES) MEN", "BADMINTON WOMEN", "BADMINTON (DOUBLES) WOMEN", "CRICKET", "VOLLEYBALL", "FOOTBALL",
            "Mehendi", "Upanyasa rachana", "Kavitha rachana", "Katha rachana", "Chithra rachana", "Cartoon", "Quiz", "Kaliman Shilpa Nirmmanam", "Flower Arrangement", "Lalitha Gaanam (Men)", "Lalitha Gaanam (Vanitha)", "Mappilappattu", "Naadodippattu", "Kavithaalapanam", "Sanghaganam", "Deshabhakthi ganam", "Naadodi Nritham (Single)", "Violin", "Chenda", "Ekanka Naadakam", "Mono Act", "Mimicry", "Prasangam (Malayalam)", "Kolkali", "Duff Muttu", "Mohiniyattam (Vanitha)", "Thiruvathira (Vanitha)", "Margamkali (Vanitha)", "Oppana (Vanitha)", "Sanghanritham (Vanitha)"
        ];

        const totalEvents = orderedEventNames.length;
        let scores = {};
        let eventStatuses = {};

        window.switchView = function(viewId) {
            document.querySelectorAll('.view-content').forEach(view => view.classList.add('hidden'));
            document.getElementById(viewId).classList.remove('hidden');
            document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
            document.querySelector(`.tab-button[onclick="switchView('${viewId}')"]`).classList.add('active');
        }

        function populateClubDropdown() {
             const clubSelect = document.getElementById('dashboardClubSelect');
             clubSelect.innerHTML = '<option value="">-- ഒരു ക്ലബ്ബ് തിരഞ്ഞെടുക്കുക --</option>';
             clubs.forEach(club => {
                 clubSelect.innerHTML += `<option value="${club}">${club}</option>`;
            });
        }
        
        onSnapshot(collection(db, "scores"), (snapshot) => {
             clubs.forEach(club => { scores[club] = {}; });
             snapshot.forEach(doc => { scores[doc.id] = doc.data(); });
             renderLeaderboard();
             renderClubReport();
        });

        onSnapshot(doc(db, "eventStatuses", "current"), (doc) => {
            eventStatuses = doc.exists() ? doc.data() : {};
            renderDashboardStatus();
            renderClubReport();
        });
        
        onSnapshot(doc(db, "announcements", "latest"), (doc) => {
            const announcementContainer = document.getElementById('announcement-container');
            const announcementText = document.getElementById('announcement-text');
            if (doc.exists() && doc.data().text) {
                announcementText.textContent = doc.data().text;
                announcementContainer.classList.remove('hidden');
            } else {
                announcementContainer.classList.add('hidden');
            }
        });

        onSnapshot(doc(db, "liveStatus", "nowHappening"), (doc) => {
            const displayContainer = document.getElementById('live-events-display');
            const listMarquee = document.getElementById('live-events-list-marquee');
            
            if (doc.exists() && doc.data().events && doc.data().events.length > 0) {
                const liveEvents = doc.data().events;
                // Join events with a visual separator for the marquee
                const eventsText = liveEvents.join('   ★★★   ');
                listMarquee.textContent = eventsText;

                // Adjust animation duration based on text length to keep speed somewhat consistent
                const animationDuration = liveEvents.length * 7; // ~7 seconds per event
                listMarquee.style.animationDuration = `${Math.max(20, animationDuration)}s`; // Minimum 20s, increases with more events

                displayContainer.classList.remove('hidden');
            } else {
                displayContainer.classList.add('hidden');
            }
        });

        function renderLeaderboard() {
            const container = document.getElementById('leaderboard-container');
            let leaderboardData = clubs.map(club => {
                let total = 0;
                if(scores[club]) Object.values(scores[club]).forEach(point => total += point);
                return { name: club, total: total };
            });
            leaderboardData.sort((a, b) => b.total - a.total);
            
            let tableHTML = `<div class="overflow-x-auto hidden md:block"><table class="w-full text-lg border-separate border-spacing-y-2"><thead><tr><th class="p-3 text-left text-sm font-bold uppercase text-white bg-gradient-to-r from-blue-600 to-indigo-500 rounded-l-lg">റാങ്ക്</th><th class="p-3 text-left text-sm font-bold uppercase text-white bg-gradient-to-r from-indigo-500 to-indigo-500">ക്ലബ്ബിന്റെ പേര്</th><th class="p-3 text-center text-sm font-bold uppercase text-white bg-gradient-to-r from-indigo-500 to-indigo-500">പോയിന്റ്</th><th class="p-3 text-center text-sm font-bold uppercase text-white bg-gradient-to-r from-indigo-500 to-blue-600 rounded-r-lg">മെഡൽ</th></tr></thead><tbody>`;
            leaderboardData.forEach((item, index) => {
                const rank = index + 1;
                let medal = ''; let rowClass = 'bg-white shadow rounded-lg'; let textClass = 'text-gray-800'; let pointClass = 'text-blue-700';
                if (rank === 1) { medal = '🥇'; rowClass = 'bg-yellow-100 border-l-4 border-yellow-500 shadow-lg'; textClass = 'text-yellow-900 font-bold'; pointClass = 'text-yellow-700'; } 
                else if (rank === 2) { medal = '🥈'; rowClass = 'bg-purple-100 border-l-4 border-purple-500 shadow-lg'; textClass = 'text-purple-900 font-bold'; pointClass = 'text-purple-700'; } 
                tableHTML += `<tr class="${rowClass}"><td class="p-4 text-center font-bold text-lg ${textClass} rounded-l-lg">${rank}</td><td class="p-4 font-semibold ${textClass}">${item.name}</td><td class="p-4 text-center font-bold text-lg ${pointClass}">${item.total}</td><td class="p-4 text-center text-3xl rounded-r-lg">${medal}</td></tr>`;
            });
            tableHTML += '</tbody></table></div>';

            let cardsHTML = '<div class="space-y-3 md:hidden">';
            leaderboardData.forEach((item, index) => {
                const rank = index + 1;
                let medal = ''; let cardClass = 'bg-white shadow-md rounded-lg'; let rankClass = 'bg-gray-200 text-gray-800';
                if (rank === 1) { medal = '🥇'; cardClass = 'bg-yellow-50 shadow-lg rounded-lg border-2 border-yellow-400'; rankClass = 'bg-yellow-400 text-white'; }
                else if (rank === 2) { medal = '🥈'; cardClass = 'bg-purple-50 shadow-lg rounded-lg border-2 border-purple-400'; rankClass = 'bg-purple-400 text-white'; }
                cardsHTML += `<div class="${cardClass} p-3 flex items-center justify-between"><div class="flex items-center"><div class="flex-shrink-0 w-10 h-10 flex items-center justify-center rounded-full ${rankClass} font-bold text-lg">${rank}</div><span class="ml-3 font-semibold text-gray-700 text-left">${item.name}</span></div><div class="text-right"><div class="font-bold text-lg text-blue-600">${item.total} pts</div><div class="text-2xl mt-1">${medal}</div></div></div>`;
            });
            cardsHTML += '</div>';
            container.innerHTML = tableHTML + cardsHTML;
        }

        function showEventListByStatus(status) {
            const listContainer = document.getElementById('dashboard-event-list');
            const titleEl = document.getElementById('event-list-title');
            const contentEl = document.getElementById('event-list-content');
            
            const statusMap = {
                completed: 'പൂർത്തിയായ മത്സരങ്ങൾ',
                pending: 'നടക്കാനുള്ള മത്സരങ്ങൾ',
                cancelled: 'ക്യാൻസൽ ചെയ്ത മത്സരങ്ങൾ',
                appeal: 'അപ്പീൽ വന്ന മത്സരങ്ങൾ'
            };

            titleEl.textContent = statusMap[status];
            
            let filteredEvents = [];
            if (status === 'pending') {
                filteredEvents = orderedEventNames.filter(eventName => !eventStatuses[eventName] || eventStatuses[eventName] === 'pending');
            } else {
                filteredEvents = orderedEventNames.filter(eventName => eventStatuses[eventName] === status);
            }
            
            if (filteredEvents.length > 0) {
                let listHTML = '<ol class="list-decimal list-inside space-y-1">';
                filteredEvents.forEach(eventName => { listHTML += `<li>${eventName}</li>`; });
                listHTML += '</ol>';
                contentEl.innerHTML = listHTML;
            } else {
                contentEl.innerHTML = '<p class="text-gray-500">ഈ വിഭാഗത്തിൽ മത്സരങ്ങളില്ല.</p>';
            }
            listContainer.classList.remove('hidden');
        }
        
        window.showEventListByStatus = showEventListByStatus;

        function renderDashboardStatus() {
            let completed = 0, cancelled = 0, appeal = 0;
            let processed = 0;
            if(eventStatuses) {
                Object.values(eventStatuses).forEach(status => {
                    if (status === 'completed') completed++;
                    else if (status === 'cancelled') cancelled++;
                    else if (status === 'appeal') appeal++;
                    if (status !== 'pending' && status) processed++;
                });
            }
            let pending = totalEvents - processed;
            
            const statusHTML = `<button onclick="showEventListByStatus('completed')" class="p-4 bg-green-100 rounded-lg text-left"><div class="text-2xl font-bold">${completed}</div><div class="text-sm text-green-800">പൂർത്തിയായി (✅)</div></button>
                                  <button onclick="showEventListByStatus('pending')" class="p-4 bg-gray-200 rounded-lg text-left"><div class="text-2xl font-bold">${pending}</div><div class="text-sm text-gray-800">നടക്കാനുള്ളവ</div></button>
                                  <button onclick="showEventListByStatus('cancelled')" class="p-4 bg-red-100 rounded-lg text-left"><div class="text-2xl font-bold">${cancelled}</div><div class="text-sm text-red-800">ക്യാൻസൽ (❌)</div></button>
                                  <button onclick="showEventListByStatus('appeal')" class="p-4 bg-yellow-100 rounded-lg text-left"><div class="text-2xl font-bold">${appeal}</div><div class="text-sm text-yellow-800">അപ്പീൽ (⚠️)</div></button>`;
            document.getElementById('overall-status').innerHTML = statusHTML;
        }

        function renderClubReport() {
            const clubName = document.getElementById('dashboardClubSelect').value;
            const container = document.getElementById('club-report-container');

            if (!clubName) {
                container.innerHTML = '<p class="text-gray-500">ഒരു ക്ലബ്ബിന്റെ വിശദമായ റിപ്പോർട്ട് കാണാൻ മുകളിൽ നിന്നും തിരഞ്ഞെടുക്കുക.</p>';
                return;
            }
            
            let reportHTML = `<h4 class="text-lg font-bold mb-2 text-blue-700">${clubName}</h4>`;
            let totalPoints = 0;
            const clubScores = scores[clubName] || {};
            
            reportHTML += '<div class="grid grid-cols-1 md:grid-cols-2 gap-x-6">';
            
            reportHTML += '<div><h5 class="font-semibold mb-2">ലഭിച്ച പോയിന്റുകൾ:</h5><ul class="list-disc list-inside space-y-1 text-sm">';
            let hasPoints = false;
            Object.keys(clubScores).sort().forEach(eventName => {
                 if (clubScores[eventName] > 0) {
                      reportHTML += `<li>${eventName}: <span class="font-bold">${clubScores[eventName]}</span> പോയിന്റ്</li>`;
                      totalPoints += clubScores[eventName];
                      hasPoints = true;
                 }
            });
            if (!hasPoints) reportHTML += '<li>പോയിന്റുകൾ ലഭിച്ചിട്ടില്ല.</li>';
            reportHTML += `</ul></div>`;

            const cancelledEvents = Object.entries(eventStatuses).filter(([,s]) => s === 'cancelled').map(([e]) => e);
            const appealedEvents = Object.entries(eventStatuses).filter(([,s]) => s === 'appeal').map(([e]) => e);
            
            let statusHTML = '<div>';
            if(cancelledEvents.length > 0) statusHTML += `<div class="mb-2"><h5 class="font-semibold">ക്യാൻസൽ ചെയ്തവ:</h5><p class="text-sm">${cancelledEvents.join(', ')}</p></div>`;
            if(appealedEvents.length > 0) statusHTML += `<div><h5 class="font-semibold">അപ്പീൽ വന്നവ:</h5><p class="text-sm">${appealedEvents.join(', ')}</p></div>`;
            statusHTML += '</div>';

            reportHTML += statusHTML;
            reportHTML += '</div>';

            reportHTML += `<div class="mt-4 pt-4 border-t font-bold text-lg">ആകെ പോയിന്റ്: <span class="text-indigo-600">${totalPoints}</span></div>`;
            reportHTML += `<div class="mt-4"><button onclick="downloadClubReportPdf('${clubName}')" class="bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-700 transition">റിപ്പോർട്ട് PDF ഡൗൺലോഡ്</button></div>`;
            
            container.innerHTML = reportHTML;
        }

        window.downloadClubReportPdf = function(clubName) {
            if (!clubName) return;
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const clubScores = scores[clubName] || {};
            let totalPoints = 0;
            const pointsBody = [];
            Object.keys(clubScores).sort().forEach(eventName => {
                if (clubScores[eventName] > 0) {
                    pointsBody.push([eventName, clubScores[eventName].toString()]);
                    totalPoints += clubScores[eventName];
                }
            });

            doc.setFontSize(18);
            doc.text('Karulai Grama Panchayat Keralolsavam 2025', 105, 20, { align: 'center' });
            doc.setFontSize(14);
            doc.text(`Club Report: ${clubName}`, 105, 28, { align: 'center' });
            let finalY = 35;

            if (pointsBody.length > 0) {
                doc.autoTable({ head: [['Event Name', 'Points']], body: pointsBody, startY: finalY });
                finalY = doc.autoTable.previous.finalY;
            } else {
                doc.setFontSize(10);
                doc.text('No points scored yet.', 14, finalY + 5);
                finalY += 10;
            }
            
            const cancelledEvents = Object.entries(eventStatuses).filter(([,s]) => s === 'cancelled').map(([e]) => e);
            const appealedEvents = Object.entries(eventStatuses).filter(([,s]) => s === 'appeal').map(([e]) => e);

            if(cancelledEvents.length > 0 || appealedEvents.length > 0) finalY += 10;
            if(cancelledEvents.length > 0) { doc.text('Cancelled Events:', 14, finalY); doc.text(cancelledEvents.join(', '), 14, finalY + 5, {maxWidth: 180}); finalY += 15; }
            if(appealedEvents.length > 0) { doc.text('Appealed Events:', 14, finalY); doc.text(appealedEvents.join(', '), 14, finalY + 5, {maxWidth: 180}); finalY += 15; }

            doc.setFont(undefined, 'bold');
            doc.text(`Total Points: ${totalPoints}`, 14, finalY + 10);
            doc.save(`${clubName.replace(/\s+/g, '_')}_report.pdf`);
        }

        document.addEventListener('DOMContentLoaded', () => {
             populateClubDropdown();
             document.getElementById('dashboardClubSelect').addEventListener('change', renderClubReport);
             switchView('leaderboard'); 
             
             // Initialize slideshow with effects
             const slides = document.querySelectorAll('.slide');
             let currentSlide = 0;
             
             function nextSlide() {
                 slides[currentSlide].classList.remove('active');
                 currentSlide = (currentSlide + 1) % slides.length;
                 slides[currentSlide].classList.add('active');
             }

             if (slides.length > 0) {
                 slides[0].classList.add('active'); // Start with the first slide
                 setInterval(nextSlide, 5000); // Change image every 5 seconds
             }
        });
    </script>
</body>
</html>

